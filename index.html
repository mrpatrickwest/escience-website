<html>
<head>
    <title>Semantic eScience at Tetherless World Constellation</title>

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Semantic eScience at Tetherless World Constellation">
    <meta name="p:domain_verify" content="97a8fdc928b958b385f3253794f51373">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-TileImage" content="mstile-144x144.png">
    <meta name="msapplication-config" content="browserconfig.xml">
    <meta name="theme-color" content="#36d3b4">
    <meta name="keywords" content="semantic, web of things, eScience, data science, tetherless world, rpi, rensselaer polytechnic institute">

    <script type="text/javascript" src="https://code.jquery.com/jquery-1.10.1.min.js"></script>
    <script type="text/javascript" src="/js/theme-query.js"></script>

    <link rel="stylesheet" type="text/css" href="/css/escience.css">
    <link rel="stylesheet" type="text/css" href="/css/escience-media.css">
</head>
<body>
<div class="top-div" id="top-div">
    <div class="image-div" id="image-div">
        <p><img class="tw-image" src="/images/twlogo.png"/></p>
        <p><img class="rpi-image" src="/images/rpi-lgnlogo-black.png"/></p>
    </div>
    <div class="logo-div" id="logo-div">
        <img class="escience-logo" id="escience-logo" src="/images/escience.png"/>
    </div>
    <div class="words-div" id="words-div">
        <div class="word-div">science</div>
        <div class="word-div">informatics</div>
        <div class="word-div">computer science</div>
        <div class="word-div">cyberinfrastructure</div>
        <div class="word-div">information technology</div>
    </div>
    <div class="blank-top-div"></div>
</div>
<div class="description-div">
    <div class="nav-div">
        <div class="nav">
            <div class="nav-item nav-item-logo"><img class="nav-title-logo" src="/images/semanticEScience.png"/></div>
            <div class="nav-item"><a href="https://tw.rpi.edu/web/ResearchAreas/SemanticeScience/Meetings">Meetings</a></div>
            <div class="nav-item"><a href="https://tw.rpi.edu/web/ResearchAreas/SemanticeScience/Projects">Projects</a></div>
            <div class="nav-item"><a href="https://tw.rpi.edu/web/ResearchAreas/SemanticeScience/Publications">Publications</a></div>
            <div class="nav-item"><a href="https://tw.rpi.edu/web/ResearchAreas/SemanticeScience/Presentations">Presentations</a></div>
        </div>
    </div>
    <div class="description" id="description"></div>
</div>
<div class="projects" id="projects"></div>
<div class="footer">
</div>
</body>
<script>
    $(document).ready(function() {
        displayDescription();
        getProjectNames();
    });

    function displayDescription() {
        displayItem(themeQuery, "https://tw.rpi.edu/xslt/escience/escience-description.xsl", "description");
    }

    function displayItem(query, xslt, id) {
        var endpoint = "http://tw.rpi.edu/endpoint/books?query=" + encodeURIComponent(query);
        $.ajax(endpoint, {
            type: "get",
            dataType: "xml",
            success: function(data, status) {
                translateXml(data, xslt, id);
            },
            error: function(xhr, textStatus, errorThrown) {
                console.log("query failed " + JSON.stringify(xhr));
            }
        });
    };

    function translateXml(xml, xslt, id) {
        $.ajax(xslt, {
            type: "get",
            dataType: "text",
            success: function(data, status) {
                var xsl = $.parseXML(data);
                translateWithXSLT(xsl, xml, id);
            },
            error: function(xhr, textStatus, errorThrown) {
                console.log("getting xslt failed " + JSON.stringify(xhr));
            }
        });
    }

    function translateWithXSLT(xsl, xml, id) {
        //console.log("got back " + xml);
        var xsltProcessor = new XSLTProcessor();
        xsltProcessor.importStylesheet(xsl);
        var description = xsltProcessor.transformToFragment(xml, document);
        //console.log("appending result " + description + " to " + id);
        $("#" + id).append(description);
    }

    function getProjectNames() {
        var endpoint = "http://tw.rpi.edu/endpoint/books?query=PREFIX+tw%3A+%3Chttp%3A%2F%2Ftw.rpi.edu%2Fschema%2F%3E%0D%0APREFIX+foaf%3A+%3Chttp%3A%2F%2Fxmlns.com%2Ffoaf%2F0.1%2F%3E%0D%0APREFIX+xsd%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2001%2FXMLSchema%23%3E%0D%0APREFIX+time%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2006%2Ftime%23%3E%0D%0A%0D%0Aselect+%3Fname+where%0D%0A%7B%0D%0A%3Fproject+a+foaf%3AProject+.%0D%0A%3Fproject+tw%3AhasThemeReference+%3Chttp%3A%2F%2Ftw.rpi.edu%2Finstances%2FSemanticeScience%3E+.%0D%0A%3Fproject+tw%3AhasAcronym+%3Fname+.%0D%0A%7D+ORDER+BY+%3Fname&stylesheet=%2Fendpoint%2Fxml-to-html.xsl&output=json";
        $.ajax(endpoint, {
            type: "get",
            dataType: "json",
            success: function(data, status) {
                if(data.results && data.results.bindings) {
                    var bindings = data.results.bindings;
                    for(i = 0; i < bindings.length; i++) {
                        var name = bindings[i].name.value;
                        name = name.replace(/\s+/g, '-').toLowerCase();
                        var html = [
                            '<div class="project">',
                            '    <div class="project-descript" id="' + name + '-descript">',
                            '        <div class="project-description" id="' + name + '-description"></div>',
                            '    </div>',
                            '    <div class="project-info" id="' + name + '-info">',
                            '        <div class="project-people" id="' + name + '-people">',
                            '        </div>',
                            '        <div class="project-sponsors" id="' + name + '-sponsors">',
                            '        </div>',
                            '    </div>',
                            '</div>'
                        ].join('');
                        $("#projects").append(html);
                    }
                    getDescriptions(data.results.bindings);
                    getPeople(data.results.bindings);
                    getSponsors(data.results.bindings);
                }
            },
            error: function(xhr, textStatus, errorThrown) {
                console.log("failed to get projects " + JSON.stringify(xhr));
            }
        });
    }

    // projects is the list of projects associated with this theme
    function getDescriptions(projects) {
        for(i = 0; i < projects.length; i++) {
            var name = projects[i].name.value;
            var query = themeProjectQuery.replace("PROJECT_NAME", name);
            var xslt = "https://tw.rpi.edu/xslt/escience/escience-project-description.xsl";
            name = name.replace(/\s+/g, '-').toLowerCase();
            var id = name + "-descript";
            displayItem(query, xslt, id);
        }
    }

    // projects is the list of projects associated with this theme
    function getPeople(projects) {
        for(var i = 0; i < projects.length; i++) {
            var projectName = projects[i].name.value;
            //console.log("getting people for " + projectName);
            var endpoint = "http://tw.rpi.edu/endpoint/books?output=json&query=";
            endpoint += encodeURIComponent(projectPIQuery.replace("PROJECT_NAME", projectName));
            $.ajax(endpoint, {
                type: "get",
                context: projectName,
                dataType: "json",
                success: function (data, status) {
                    //console.log("got back people info " + JSON.stringify(data));
                    if (data.results && data.results.bindings) {
                        var bindings = data.results.bindings;
                        if(bindings.length > 0) {
                            var html = '<div class="heading">Investigators</div>';
                            html += '<ul class="ulist">';
                            for (var j = 0; j < bindings.length; j++) {
                                var name = bindings[j].name.value;
                                var page = bindings[j].page.value;
                                html += '<li class="ulist-item"><a href="' + page + '">' + name + '</a></li>';
                            }
                            html += '</ul>';
                            var pName = this.replace(/\s+/g, '-').toLowerCase();
                            $("#" + pName + "-people").append(html);
                        }
                    }
                },
                error: function(xhr, textStatus, errorThrown) {
                    console.log("failed to get people for project " + projectName + ": " + JSON.stringify(xhr));
                }
            })
        }
    }

    // projects is the list of projects associated with this theme
    function getSponsors(projects) {
        for(var i = 0; i < projects.length; i++) {
            var projectName = projects[i].name.value;
            console.log("getting sponsors for " + projectName);
            var endpoint = "http://tw.rpi.edu/endpoint/books?output=json&query=";
            endpoint += encodeURIComponent(projectSponsorQuery.replace("PROJECT_NAME", projectName));
            $.ajax(endpoint, {
                type: "get",
                context: projectName,
                dataType: "json",
                success: function (data, status) {
                    console.log("got back sponsors info " + JSON.stringify(data));
                    if (data.results && data.results.bindings) {
                        var bindings = data.results.bindings;
                        if(bindings.length > 0) {
                            var html = '<div class="heading sponsor-heading">Sponsors</div>';
                            for (var j = 0; j < bindings.length; j++) {
                                var name = bindings[j].name.value;
                                console.log("name = " + name);
                                var page = bindings[j].page.value;
                                console.log("page = " + page);
                                var logo = bindings[j].logo.value;
                                console.log("logo = " + logo);
                                var acronym = bindings[j].acronym.value;
                                console.log("acronym = " + acronym);
                                html += '<div class="projspons">';
                                if (logo && logo != "") {
                                    html += '<div class="projspons-imgdiv">';
                                    html += '<img class="projspons-img" src="' + logo + '">';
                                    html += '</div>';
                                    html += '<div class="projspons-name">';
                                    html += '<a href="' + page + '">' + name + '</a>';
                                    html += '</div>';
                                } else if(acronym && acronym != "") {
                                    html += '<div class="projspons-name">';
                                    html += '<a href="' + page + '">' + acronym + '</a>';
                                    html += '</div>';
                                } else {
                                    html += '<div class="projspons-name">';
                                    html += '<a href="' + page + '">' + name + '</a>';
                                    html += '</div>';
                                }
                                html += '</div>';
                            }
                            var pName = this.replace(/\s+/g, '-').toLowerCase();
                            $("#" + pName + "-sponsors").append(html);
                        }
                    }
                },
                error: function(xhr, textStatus, errorThrown) {
                    console.log("failed to get people for project " + projectName + ": " + JSON.stringify(xhr));
                }
            })
        }
    }
</script>
</html>

